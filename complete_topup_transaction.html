<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- Required meta tags always come first -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      <title> FarmAid :: Dashboard</title>
      <link rel="icon" type="image/png" href="favicons/images-favicon.png">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
         integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
      <!--Core CSS -->
      <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700&amp;display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
      <link rel="stylesheet" href="css/css-bulma.css">
      <link rel="stylesheet" href="css/css-app.css">
      <link rel="stylesheet" href="css/css-dashboard.css">
      <link rel="stylesheet" href="css/css-icons.min.css">
      <link rel="stylesheet" href="css/gap.css">
      <link rel="stylesheet" href="css/custom.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />
      
   </head>
   <body>
     
         <div class="pageloader"></div>
         <div class="infraloader is-active"></div> <!-- Main sidebar menu -->
      <nav class="main-menu">
         <div class="main-menu-inner">
            <!-- Side icon menu -->
            <ul>
               <li class="main-logo">
                  <a href="javascript:" onclick="goHomePartner();">
                  <img src="img/farm_aid_footer.png" alt="">
                  </a>
               </li>
               <li class="side-icon" data-child-menu="dashboard-menu">
                  <i class="sl sl-icon-grid"></i>&nbsp;<span style="background-color: #26d0a8; font-style: bold; color: white; padding-right: 5px; padding-left: 5px; border-radius: 5px;">Menu</span>
               </li>
            </ul>
            <!-- /Side icon menu -->
         </div>
      </nav>
      <!-- /Main sidebar menu -->
      <!-- Top Navbar -->
      <nav class="navbar dashboard-nav">
         <!-- Nav left -->
         <div class="navbar-brand">
            <!-- Reader mode switch -->
            <div class="navbar-item reader-switch is-hidden-desktop is-hidden-tablet">
               <div class="field">
                  <input id="reader-mode-switch" type="checkbox" name="reader-mode-switch"
                     class="switch is-outlined is-primary is-small"><label id="reader-mode-toggle"
                     for="reader-mode-switch"></label>
               </div>
            </div>
            <!-- /Right sidebar trigger -->
            <a id="mobile-dashboard-trigger" class="navbar-item hamburger-btn is-hidden-desktop"
               href="javascript:void(0);">
            <span class="menu-toggle is-hidden-mobile">
               <span class="icon-box-toggle">
                  <span class="rotate">
                     <i class="icon-line-top"></i>
                     <i class="icon-line-center"></i>
                     <i class="icon-line-bottom"></i>
                  </span>
               </span>
            </span>
            </a>
         </div>
         <!-- Nav right -->
         <div class="navbar-menu">
            <div class="navbar-end">
               <!-- Account dropdown -->
               <div class="drop-pop">
                  <div id="profile-me" class="icon-button accounts-button">
                  </div>
                  <div class="drop-wrapper accounts-drop">
                     <div class="drop-inner has-arrow">
                        <div id="profile-head" class="head-block">
                        </div>
                        <div class="accounts-block is-hidden">
                           <a class="account" href="javascript:">
                              <img src="https://www.gravatar.com/avatar/?d=identicon" alt=""
                                 data-demo-src="https://www.gravatar.com/avatar/?d=identicon">
                              <div class="meta">
                                 <span>Don Onubuon</span>
                                 <span>onubuon@farmnovation.com</span>
                              </div>
                           </a>
                        </div>
                        <div class="logout-block">
                           <a id="logout" class="button" href="javascript:">Logout from all accounts</a>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- Messages dropdown -->
            </div>
         </div>
      </nav>
      <div class="mobile-nav is-hidden-desktop is-hidden-mobile">
         <div class="container is-fluid">
            <div class="mobile-nav-inner">
               <a class="mobile-item" href="javascript:">
               <i data-feather="bell"></i>
               <span class="new-circle gelatine"></span>
               </a>
               <a class="mobile-item" href="javascript:">
               <i data-feather="mail"></i>
               <span class="new-circle gelatine"></span>
               </a>
               <a class="mobile-item quickview-trigger" data-quickview="main-quickview" href="javascript:">
               <i data-feather="message-square"></i>
               </a>
               <a class="mobile-item" href="javascript:">
               <img src="https://www.gravatar.com/avatar/?d=identicon" alt=""
                  data-demo-src="https://www.gravatar.com/avatar/?d=identicon"></a>
            </div>
         </div>
      </div>
      <!-- Main dashboard container -->
      <div id="dashboard-wrapper" class="dashboard-outer">
         <div class="dashboard-inner">
            <!-- Dashboard Wrapper -->
            <div class="dashboard-wrapper">
               
               <!-- Main content -->
               <div id="main-dashboard" class="section-wrapper margin-button">

                  <!-- Widgets -->
                  <div class="bd-notification is-dark">
                    <h2 class="is-primary has-text-centered "><b>Your Top Up was completed successfully!</b></h2><hr>
                 
                    <div class="columns is-multiline">
                      
                    </div>
                    <div class="tile is-ancestor">
                        <div class="tile is-parent">
                          <article class="tile is-child notification">
                            <div class="content has-text-centered">
                              <p class="title">Thank you for completing your payment</p>
                              <p class="subtitle">Please do the following to verify your payments</p>
                              <div class="content ">
                                <!-- Content -->
                                <button style="border-radius: 5px;" class="" onclick="verify_payment()">Verify Payments</button>
                                <div class="has-ribbon-left is-small is-hidden">
                                    <div class="ribbon is-small is-secondary">Next Steps</div><br>
                                    Click <button>here</button> to go back to your dashboard
                                </div>
                              </div>
                            </div>
                          </article>
                        </div>
                      </div>
              </div>
                 
               </div>
            </div>
         </div>
      </div>
      <!-- /Invite User Modal -->
      <!-- Concatenated jQuery and plugins -->
      <!-- jQuery first, then Popper.js, then Bootstrap JS -->
      <!--Start of Tawk.to Script-->
      <script type="text/javascript">
         var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
         (function(){
         var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
         s1.async=true;
         s1.src='https://embed.tawk.to/5e9985c335bcbb0c9ab212f0/default';
         s1.charset='UTF-8';
         s1.setAttribute('crossorigin','*');
         s0.parentNode.insertBefore(s1,s0);
         })();
      </script>
      <!--End of Tawk.to Script-->
      <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
         integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
         crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
         integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
         crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
         integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
         crossorigin="anonymous"></script>
      <!-- Routing start -->
      <script src="js/farmaid_route.js"></script>
      <script src="js/farmaid_router.js"></script>
      <script src="js/option.js"></script>
      <script src="js/launcher.js"></script>
      <!-- Routing End -->
      <script src="js/swal.js"></script>
      <script src="js/dash/js-app.js"></script>
      <script src="js/dash/js-core.js"></script>
      <script src="js/dash/js-common.js"></script>
      <script src="js/dash/js-auth.js"></script>
      <script src="./js/dash/market_actor.js"></script>
      <script>
          function verify_payment() {
             //Get the txnref from the location object
            //var txn_ref = window.location;
            var regex = /\=(.*?)\&/;
            var strToMatch = window.location;
            var txn_refs = regex.exec(window.location);
             
             swal.fire({
                 title: 'Please wait',
                 text: 'Your transaction is being verified',
                 icon: 'info',
                 allowOutsideClick: false,
                 showConfirmButton: false,
                 timer: 3000,
             }).then(() => {
                 console.log("Done with this ", txn_refs[1]);
                 //Do payment verification from paystack using transaction reference 
                 // create request object
                 swal.fire({
                     title: 'Please wait',
                     text: 'Verifying your payment transaction',
                     icon: 'info',
                     allowOutsideClick: false,
                     showConfirmButton: false,
                 });
                 const my_token = localStorage.getItem('access_token');
                 var userObj = parseJwt(localStorage.getItem('access_token'));
                 const payment_info = {
                    "trxref": txn_refs[1],
                    "user_id": userObj.user.id,
                }
                var verify_request = new Request('https://farm-aid-backend.herokuapp.com/api/topup/paystack_verify', {
                    method: 'POST',
                    body: JSON.stringify(payment_info),
                    headers: new Headers({
                    'Content-Type': 'application/json',
                    'Authorization': my_token  
                    })
                });

                console.log("")
                // pass request object to `fetch()`
                fetch(verify_request)
                    .then(async (res) => {
                    //$('.modal').css({ 'display': 'none' });
                    var resp = await res.json();
                    if(resp !== null){
                        swal.close();
                        swal.fire({
                            title: "Top up done",
                            text: "Your top up was verified successfully",
                            timer: 3000,
                            icon: 'success',
                        }).then(() => console.log('Done with top up...', resp));
                    }
                    }).catch((e)=> {
                    debugger
                    console.log(e)
                    console.log("I was here");
                    swal.close();
                    swal.fire({
                        title: "Message approval wasn't completed",
                        text: "Message Not sent",
                        timer: 3000,
                        icon: 'info',
                    });
                    console.log("Finally tired");
                    
                    });
                 //window.location.replace('https://farmaid.net/partnerDashboard.html');
             })
         }
      </script>
   </body>
</html>